"""
CLI interface Ğ´Ğ»Ñ gym Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ.

ĞŸÑ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº:
- add: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ
- today: Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½Ğ¸Ñ… ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹
- max: Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ
- progress: Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ·Ğ° 3 Ğ¼ĞµÑÑÑ†Ğ°
- last: Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ
"""

import os
from datetime import datetime
from pathlib import Path

import click

from gym.db import Database
from gym.models import Exercise
from gym.parser import parse_exercise_input


# ĞŸÑƒÑ‚ÑŒ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
DEFAULT_DB_PATH = os.path.expanduser("~/.gym/gym.db")


def get_db() -> Database:
    """
    ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
    Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ~/.gym ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚.
    """
    db_path = Path(DEFAULT_DB_PATH)
    db_path.parent.mkdir(parents=True, exist_ok=True)
    db = Database(str(db_path))
    db.init_db()
    return db


@click.group()
def cli():
    """
    ğŸ‹ï¸ Gym CLI â€” Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ.

    Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ, Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ, Ğ±ĞµĞ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ñ‹!

    \b
    Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚:
      gym add "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°" 80kg 8x3      Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ
      gym today                         Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ğ» ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ
      gym max "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°"               ĞœĞ¾Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´
      gym progress "Ğ¿Ñ€Ğ¸ÑĞµĞ´"            Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ·Ğ° 3 Ğ¼ĞµÑÑÑ†Ğ°
      gym last "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ"              ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ·

    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ --help Ğ¿Ğ¾ÑĞ»Ğµ Ğ»ÑĞ±Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚ĞµĞ¹.
    """
    pass


@cli.command()
@click.argument("name")
@click.argument("params", nargs=-1, required=True)
@click.option("--note", "-n", default=None, help="Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ° Ğº ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ")
def add(name: str, params: tuple, note: str | None):
    """
    Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº.

    \b
    NAME    ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ (Ğ² ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ… ĞµÑĞ»Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ»Ğ¾Ğ²)
    PARAMS  Ğ’ĞµÑ, Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ñ, Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹ Ğ² Ğ»ÑĞ±Ğ¾Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
    Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹:
      gym add "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°" 80kg 8reps 3sets    ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
      gym add "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°" 80kg 8x3            ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
      gym add "Ğ¿Ñ€Ğ¸ÑĞµĞ´" 100 5 4               Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ğ¸ÑĞ»Ğ°
      gym add "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ" 120ĞºĞ³ 5x3           ĞšĞ¸Ñ€Ğ¸Ğ»Ğ»Ğ¸Ñ†Ğ° "ĞºĞ³"

    \b
    Ğ¡ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°Ğ¼Ğ¸:
      gym add "Ğ¿Ñ€Ğ¸ÑĞµĞ´" 100kg 5x4 --note "ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ½Ñ‹Ğ»Ğ¾"
      gym add "Ğ¶Ğ¸Ğ¼" 60kg 12x3 -n "Ñ€Ğ°Ğ·Ğ¼Ğ¸Ğ½ĞºĞ°, Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ²ĞµÑ"
      gym add "Ñ‚ÑĞ³Ğ°" 80kg 10x4 --note "Ñ…Ğ²Ğ°Ñ‚ Ğ¿Ğ¾Ğ´Ğ²Ğ¾Ğ´Ğ¸Ñ‚"

    \b
    Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ:
      gym add "Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ" 0kg 10x4        Ğ‘ĞµĞ· Ğ²ĞµÑĞ°
      gym add "Ğ¿Ğ»Ğ°Ğ½ĞºĞ°" 0kg 1x3               Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ĞºĞ°
      gym add "Ñ„Ñ€Ğ°Ğ½Ñ†ÑƒĞ·ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼" 30kg 12x3    Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞĞ¨Ğ˜Ğ‘ĞšĞ˜ (Ñ‚Ğ°Ğº ĞĞ• Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚):
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      gym add Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ° 80kg 8x3              âœ— ĞÑƒĞ¶Ğ½Ñ‹ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸!
      gym add "Ğ¶Ğ¸Ğ¼" 80                       âœ— ĞœĞ°Ğ»Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
      gym add "Ğ¶Ğ¸Ğ¼" Ğ²Ğ¾ÑĞµĞ¼ÑŒĞ´ĞµÑÑÑ‚ 8x3          âœ— Ğ§Ğ¸ÑĞ»Ğ° Ñ†Ğ¸Ñ„Ñ€Ğ°Ğ¼Ğ¸
    """
    db = get_db()

    # ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ² ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€ÑĞµÑ€Ğ°
    params_str = " ".join(params)

    try:
        weight, reps, sets = parse_exercise_input(params_str)
    except ValueError as e:
        click.echo(click.style(f"ĞÑˆĞ¸Ğ±ĞºĞ°: {e}", fg="red"))
        raise SystemExit(1)

    exercise = Exercise(
        id=None,
        name=name,
        weight=weight,
        reps=reps,
        sets=sets,
        note=note,
        created_at=datetime.now()
    )

    try:
        db.add_exercise(exercise)
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²ĞµÑ: ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼ .0 ĞµÑĞ»Ğ¸ Ñ†ĞµĞ»Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾
        weight_str = f"{int(weight)}" if weight == int(weight) else f"{weight}"
        click.echo(click.style(
            f"âœ“ Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾: {name} {weight_str}ĞºĞ³ {reps}x{sets}",
            fg="green"
        ))
    except Exception as e:
        click.echo(click.style(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸: {e}", fg="red"))
        raise SystemExit(1)


@cli.command()
def today():
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ.

    Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ñ Ğ²ĞµÑĞ°Ğ¼Ğ¸, Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°Ğ¼Ğ¸.

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      gym today                              Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ
      gym today | head -5                    ĞŸĞµÑ€Ğ²Ñ‹Ğµ 5 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹
      gym today | grep "Ğ¶Ğ¸Ğ¼"                 Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¶Ğ¸Ğ¼Ñ‹
      gym today | wc -l                      Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¹

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ’Ğ«Ğ’ĞĞ”Ğ:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ:

      1. Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°: 80ĞºĞ³ 8x3
      2. Ğ¿Ñ€Ğ¸ÑĞµĞ´: 100ĞºĞ³ 5x4 (ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ½Ñ‹Ğ»Ğ¾)
      3. ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ: 120ĞºĞ³ 3x5

    \b
    Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾:
      Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾
    """
    db = get_db()
    exercises = db.get_today_exercises()

    if not exercises:
        click.echo(click.style("Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾", fg="yellow"))
        return

    click.echo(click.style("Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ:", fg="cyan", bold=True))
    click.echo()

    for i, ex in enumerate(exercises, 1):
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²ĞµÑ
        weight_str = f"{int(ex.weight)}" if ex.weight == int(ex.weight) else f"{ex.weight}"
        line = f"{i}. {ex.name}: {weight_str}ĞºĞ³ {ex.reps}x{ex.sets}"

        if ex.note:
            line += click.style(f" ({ex.note})", fg="bright_black")

        click.echo(line)


@cli.command("max")
@click.argument("name")
def max_weight(name: str):
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´ Ğ² ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğ¸.

    \b
    NAME  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ

    ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ Ğ·Ğ° Ğ²ÑÑ‘ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ Ğ´Ğ°Ñ‚Ñƒ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ.

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      gym max "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°"                     Ğ ĞµĞºĞ¾Ñ€Ğ´ Ğ² Ğ¶Ğ¸Ğ¼Ğµ
      gym max "Ğ¿Ñ€Ğ¸ÑĞµĞ´"                       Ğ ĞµĞºĞ¾Ñ€Ğ´ Ğ² Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğµ
      gym max "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚ÑĞ³Ğ°"                Ğ ĞµĞºĞ¾Ñ€Ğ´ Ğ² ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğ¹
      gym max "Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ"                 ĞœĞ°ĞºÑ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹
      gym max Ğ¶Ğ¸Ğ¼                            Ğ‘ĞµĞ· ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº (1 ÑĞ»Ğ¾Ğ²Ğ¾)

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ’Ğ«Ğ’ĞĞ”Ğ:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°: 95ĞºĞ³ (15.12.2024)

    \b
    Ğ•ÑĞ»Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾:
      Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ 'Ñ‚ÑĞ³Ğ° Ğ±Ğ»Ğ¾ĞºĞ°' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞĞ”Ğ¡ĞšĞĞ—ĞšĞ˜:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      â€¢ ĞŸĞ¾Ğ¸ÑĞº Ğ½ĞµÑ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ğº Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ñƒ
      â€¢ Ñ‘ Ğ¸ Ğµ ÑÑ‡Ğ¸Ñ‚Ğ°ÑÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¼Ğ¸
      â€¢ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ
    """
    db = get_db()
    result = db.get_max_weight(name)

    if result is None:
        click.echo(click.style(f"Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ '{name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾", fg="yellow"))
        return

    weight, date = result
    weight_str = f"{int(weight)}" if weight == int(weight) else f"{weight}"
    date_str = date.strftime("%d.%m.%Y")

    click.echo(click.style(
        f"ğŸ† ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ {name}: {weight_str}ĞºĞ³ ({date_str})",
        fg="green",
        bold=True
    ))


@cli.command()
@click.argument("name")
def progress(name: str):
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 3 Ğ¼ĞµÑÑÑ†Ğ°.

    \b
    NAME  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ

    Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ Ğ´Ğ°Ñ‚Ğ°Ğ¼Ğ¸, Ğ²ĞµÑĞ°Ğ¼Ğ¸ Ğ¸ ASCII-Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ¼.

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      gym progress "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°"                Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¶Ğ¸Ğ¼Ğ°
      gym progress "Ğ¿Ñ€Ğ¸ÑĞµĞ´"                  Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°
      gym progress "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ"                Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğ¹
      gym progress "Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ"            ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğ¹
      gym progress Ğ¶Ğ¸Ğ¼                       Ğ‘ĞµĞ· ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº (1 ÑĞ»Ğ¾Ğ²Ğ¾)

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ’Ğ«Ğ’ĞĞ”Ğ:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ° Ğ·Ğ° 3 Ğ¼ĞµÑÑÑ†Ğ°:

        01.10.2024      70ĞºĞ³ 8x3  ========
        15.10.2024      75ĞºĞ³ 8x3  ===========
        01.11.2024      80ĞºĞ³ 6x3  ==============
        15.11.2024      85ĞºĞ³ 5x3  =================
        01.12.2024      90ĞºĞ³ 4x3  ====================

      Ğ’ÑĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹: 5
      ĞœĞ¸Ğ½: 70ĞºĞ³ | ĞœĞ°ĞºÑ: 90ĞºĞ³ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ: 80.0ĞºĞ³

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Ğ˜ĞĞ¢Ğ•Ğ ĞŸĞ Ğ•Ğ¢ĞĞ¦Ğ˜Ğ¯ Ğ“Ğ ĞĞ¤Ğ˜ĞšĞ:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      â€¢ Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ¾ÑĞºĞ¸ = Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ
      â€¢ Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ñ€ = Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ
      â€¢ Ğ’Ğ¸Ğ´ĞµĞ½ Ñ‚Ñ€ĞµĞ½Ğ´: Ñ€Ğ¾ÑÑ‚, Ğ¿Ğ»Ğ°Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ ÑĞ¿Ğ°Ğ´
    """
    db = get_db()
    history = db.get_exercise_history(name, days=90)

    if not history:
        click.echo(click.style(f"Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ '{name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾", fg="yellow"))
        return

    click.echo(click.style(f"ğŸ“ˆ ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ {name} Ğ·Ğ° 3 Ğ¼ĞµÑÑÑ†Ğ°:", fg="cyan", bold=True))
    click.echo()

    # ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ Ğ´Ğ»Ñ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°
    weights = [ex.weight for ex in history]
    min_weight = min(weights)
    max_weight = max(weights)
    weight_range = max_weight - min_weight if max_weight > min_weight else 1

    # Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ° ASCII Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°
    graph_width = 20

    for ex in history:
        date_str = ex.created_at.strftime("%d.%m.%Y")
        weight_str = f"{int(ex.weight)}" if ex.weight == int(ex.weight) else f"{ex.weight}"

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ASCII Ğ±Ğ°Ñ€
        if weight_range > 0:
            bar_length = int((ex.weight - min_weight) / weight_range * graph_width) + 1
        else:
            bar_length = graph_width
        bar = click.style("=" * bar_length, fg="green")

        line = f"  {date_str}  {weight_str:>6}ĞºĞ³ {ex.reps}x{ex.sets}  {bar}"
        click.echo(line)

    # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    click.echo()
    avg_weight = sum(weights) / len(weights)
    avg_str = f"{avg_weight:.1f}"
    min_str = f"{int(min_weight)}" if min_weight == int(min_weight) else f"{min_weight}"
    max_str = f"{int(max_weight)}" if max_weight == int(max_weight) else f"{max_weight}"

    click.echo(click.style(f"Ğ’ÑĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹: {len(history)}", fg="bright_black"))
    click.echo(click.style(f"ĞœĞ¸Ğ½: {min_str}ĞºĞ³ | ĞœĞ°ĞºÑ: {max_str}ĞºĞ³ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ: {avg_str}ĞºĞ³", fg="bright_black"))


@cli.command()
@click.argument("name")
def last(name: str):
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· Ğ´ĞµĞ»Ğ°Ğ» ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ.

    \b
    NAME  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ

    ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ğ¾ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ²ĞµÑ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
    ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸.

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ¯:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      gym last "ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ"                    ĞšĞ¾Ğ³Ğ´Ğ° Ğ´ĞµĞ»Ğ°Ğ» ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ÑƒÑ
      gym last "Ğ¿Ñ€Ğ¸ÑĞµĞ´"                      ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¸ÑĞµĞ´Ğ°Ğ»
      gym last "Ğ¶Ğ¸Ğ¼ Ğ»Ñ‘Ğ¶Ğ°"                    ĞšĞ¾Ğ³Ğ´Ğ° Ğ¶Ğ°Ğ»
      gym last "Ñ„Ñ€Ğ°Ğ½Ñ†ÑƒĞ·ÑĞºĞ¸Ğ¹ Ğ¶Ğ¸Ğ¼"             Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ
      gym last Ğ¿Ğ¾Ğ´Ñ‚ÑĞ³Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ                  Ğ‘ĞµĞ· ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº (1 ÑĞ»Ğ¾Ğ²Ğ¾)

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ’Ğ«Ğ’ĞĞ”Ğ:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ°Ñ: 10.01.2025 - 140ĞºĞ³ 3x5

    \b
    Ğ¡ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¾Ğ¹:
      ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· Ğ¿Ñ€Ğ¸ÑĞµĞ´: 08.01.2025 - 100ĞºĞ³ 5x4 (ĞºĞ¾Ğ»ĞµĞ½Ğ¾ Ğ½Ñ‹Ğ»Ğ¾)

    \b
    Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾:
      Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ 'Ğ²Ñ‹Ğ¿Ğ°Ğ´Ñ‹' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾

    \b
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Ğ—ĞĞ§Ğ•Ğœ Ğ­Ğ¢Ğ ĞĞ£Ğ–ĞĞ:
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    \b
      â€¢ Ğ’ÑĞ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ²ĞµÑ Ğ¿ĞµÑ€ĞµĞ´ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹
      â€¢ ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ» Ğ»Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ Ğ¼Ñ‹ÑˆÑ†
      â€¢ ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ°
    """
    db = get_db()
    exercise = db.get_last_exercise(name)

    if exercise is None:
        click.echo(click.style(f"Ğ£Ğ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ '{name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾", fg="yellow"))
        return

    date_str = exercise.created_at.strftime("%d.%m.%Y")
    weight_str = f"{int(exercise.weight)}" if exercise.weight == int(exercise.weight) else f"{exercise.weight}"

    result = f"ğŸ“… ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· {name}: {date_str} â€” {weight_str}ĞºĞ³ {exercise.reps}x{exercise.sets}"

    if exercise.note:
        result += click.style(f" ({exercise.note})", fg="bright_black")

    click.echo(click.style(result, fg="cyan"))


def main():
    """Entry point Ğ´Ğ»Ñ CLI Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ."""
    cli()


if __name__ == "__main__":
    main()
